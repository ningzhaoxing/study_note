```go
package gopool  
  
import (  
    "sync"  
)  
  
type GoPool struct {  
    taskChannel  chan func()    // 任务存放的队列  
    taskMutex    sync.Mutex     // 用于保证计数正确性的锁  
    maxWorkerNum int64          // 协程最大数  
    curWorkerNum int64          // 当前协程数  
    waitGroup    sync.WaitGroup // 用于等待所有任务完成  
}  
  
// NewGoPoolWithCapacity 创建指定协程数量和最大协程容量的协程池  
func NewGoPoolWithCapacity(workerNum int64, maxTask int64) *GoPool {  
    if workerNum < 1 || maxTask < 1 {  
       panic("invalid go pool param")  
    }  
    return &GoPool{  
       taskChannel:  make(chan func(), maxTask),  
       maxWorkerNum: workerNum,  
       curWorkerNum: 0,  
    }  
}  
  
// NewGoPool 创建指定协程数量的协程池  
func NewGoPool(workerNum int64) *GoPool {  
    return NewGoPoolWithCapacity(workerNum, 1024)  
}  
  
// Go 提交一个任务  
// 1. 如果当前协程树小于最大协程数量，则新建go routine执行任务；  
// 2. 如果当前协程数大于等于最大协程数量，则任务放到Channel中等待；  
// 3. 新建的协程，执行完当前任务需要去队列中拉任务，拉不到则结束当前协程并减少当前协程的计数；  
func (p *GoPool) Go(newTask func()) {  
    if newTask == nil {  
       return  
    }  
  
    p.taskMutex.Lock()  
  
    // 对原有任务添加释放wait group功能  
    p.waitGroup.Add(1)  
    innerTask := func() {  
       defer p.waitGroup.Done()  
       newTask()  
    }  
  
    if p.curWorkerNum < p.maxWorkerNum {  
       // 如果当前协程数量小于最大协程数量，则新建go routine  
       p.curWorkerNum++  
       go func() {  
          defer func() {  
             p.taskMutex.Lock()  
             p.curWorkerNum--  
             p.taskMutex.Unlock()  
          }()  
          innerTask() // 执行当前任务  
  
          // 执行完当前任务之后，去队列拉一下最新任务  
          for channelTask := range p.taskChannel {  
             channelTask()  
          }  
       }()  
    } else {  
       // 如果当前协程数量大于等于最大协程数量，则当前任务需要排队  
       p.taskChannel <- innerTask  
    }  
    p.taskMutex.Unlock()  
}  
  
// CloseAndWait 关闭协程池，并等待所有任务执行完成  
func (p *GoPool) CloseAndWait() {  
    close(p.taskChannel)  
    p.waitGroup.Wait()  
}  
  
// CloseWithoutWait 关闭协程池，但是不等待所有任务执行完成  
func (p *GoPool) CloseWithoutWait() {  
    close(p.taskChannel)  
}
```