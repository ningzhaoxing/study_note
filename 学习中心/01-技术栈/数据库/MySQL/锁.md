# 锁

mysql innodb 引擎可以从锁的颗粒度、锁的类型、锁的态度分类。

1. **锁的颗粒度**：
   1. 全局锁：用于数据库全量逻辑备份，被锁期间数据库处于只读状态，
   2. 表级锁：
      1. 表锁：锁整张表。读操作加读锁，写操作加写锁。读写互斥、写写互斥。
      2. 意向锁：解决在加表锁时，需要扫描整张表检查表中记录加锁的情况，才能决定是否可以加表锁的全表扫描问题。在向表中执行读操作时，会给该表加上读意向锁，在向表中执行写操作时，会给该表加上写意向锁。写意向锁会和共享表锁、排他表锁互斥。
      3. 元数据锁：为了避免在进行表结构变更的时候，进行CRUD导致未知不安全问题。在进行CRUD时会加元数据读锁、在进行表结构变更时，会加元数据写锁。读写互斥，只有当表中没有CRUD操作时，才能获取到写锁，否则会阻塞，直到事务结束释放读锁。
      4. AUTO-INCR 锁：在插入记录时，获取自增主键时加锁。有三种加锁模式（**不同模式的并发性能不同**）：
         1. 传统锁定模式：每当执行 UPDATE 语句时都会获得一个表级自增锁，直到事务结束才释放。
         2. 连续锁定模式（8.0之前的默认模式）：批量插入仍使用表级自增锁；简单插入只在获取自增值的时候加锁。
         3. 交错锁定模式（默认模式）：无论是简单插入还是批量插入、混合插入都不使用表级锁，只在获取值的时候加锁。
   3. 行级锁：
      1. 记录锁
      2. 间隙锁
      3. 临键锁
      4. 插入意向锁

2. **锁的类型**
   1. 共享锁
   2. 互斥锁

3. **锁的态度**
   1. 乐观锁
   2. 悲观锁