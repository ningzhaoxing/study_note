---

mindmap-plugin: basic

---

# 数据链路层

## 概述
- 封装成帧
    - 指给上层交付的协议数据单元添加帧头和帧尾
    - 透明传输
        - 指对上层交付的传输数据没有任何限制
        - 面向字节的物理链路使用字节填充的方法实现
        - 面向比特的物理链路使用比特填充的方法实现
    - 最大传输单元MTU
        - 默认1500字节
- 差错检测
    - 奇偶校验
        - 在待发送的数据后添加1位奇偶校验位，使整个数据中"1"的个数位奇数或偶数
        - 如果由奇数个位发生误码，则奇偶性发生变化，可以检查出误码
        - 如果有偶数个位发生误码，则奇偶性不发生变化，不能检查出误码(漏检)
    - 循环冗余校验CRC
        - 双方约定一个多项式G(x)
            - 多项目必须含最低次系数
        - 基于待发送的数据和多项式计算冗余码，添加到发传输数据后
        - 接收方计算数据判断是否产生误码
        - 计算冗余码过程
            - 构造被除数
                - 待发送数据添加生成式最高次数个0
            - 构造除数
                - 多项式各项系数组成的比特串
            - 做异或运算
            - 检查余数
                - 余数要和多项式的最高次数相同，不够，在前面补0

## 可靠传输
- 概念
    - 数据链路层向上层提供的服务类型
        - 不可靠传输服务
            - 直接丢弃误码的帧
        - 可靠传输服务
            - 想办法实现发送端发送什么，接收端就收到什么
    - 传输差错
        - 比特差错
        - 分组差错
        - 分组失序
        - 分组重复
- 实现机制
    - 停止-等待协议
        - 发送方发送一个数据分组后就停止发送分组，等待接收方返回的确认分组或否认分组
        - 超时重传
            - 如果超时未收到接收方的确认或否认分组，则进行重发
        - 对每个分组带上序号
            - 为避免分组重复，需要一个比特 来对分组进行编号
            - 接收方丢弃重复的分组
        - 对每个确认分组带上序号
            - 避免确认迟到导致的重复的确认分组问题
        - 信道利用率计算
            - 数据帧发送时延/数据帧发送时延+2×单播传播时延
        - 缺点
            - 信道利用率低
    - 回退N帧协议
        - 要求
            - 发送窗口为1~2^n-1
            - 接收窗口为1
    - 选择重传协议
        - 要求
            - 3. 接收窗口尺寸Wr取值:Wr = Wt

## 码片序列挑选原则
-
    -
        -
            - 1. 每个站的码片不可相同
        -
            - 2. 每个站的码片序列必须相互正交(内积为0)
    -
        - S*T=0
        - S*反T=0
        - S*S=1
        - S*反S=-1
- 不灵活，对突发性数据传输信道利用率低，适合在物理层使用
- 信道复用
- 动态接入控制
    - 受控接入
        - 集中控制
        - 分散控制
    - 随机接入
        - 总线局域网使用的CSMA/CD协议
            - 载波监听CS
                - 每个站在发送帧之前先要检测总线是否有其他站点在发送帧(先听后说)
            - 多址接入MA
                - 多个站连接在一条总线，竞争使用总线
            - 碰撞检测CD
                - 每个正在发送帧的站边发送边检测碰撞(边说边听)
                    - 一旦总线上出现碰撞，则立即停止发送，退避一段时间后再次发送
            - 争用期(碰撞窗口)
                - 以太网端到端往返传播i实验2t成为争用期或碰撞窗口
                - 在争用期内没有检测到碰撞才认为不会发生碰撞
                - 共享式以太网不能连接太多的主机，使用的总线也不能太长
                    - 10Mb/s以太网把争用期定位512比特发送时间，即51.2μs
            - 最小帧长
                - 以太网规定最小帧长为64字节，即512比特
                - 最小帧长 = 争用期2t * 数据传输速率(信道带宽)
            - 最大帧长
            - 截断二进制指数退避算法
                - 退避时间=争用期2t * 随机数r
                - 随机数r从离散的整数集合{0,1,...,(2^k-1)}中随机选取一数
                    - k=Min[重传次数，10]
                - 可使重传需要推迟的平均时间随重传次数而增大，因而减小发生碰撞的概率
                - 当重传达16仍不能成功时，则丢弃该帧，并向高层报告
            - 信道利用率
                - 理想状态下
                    - 不会产生碰撞且总线一空闲就立刻发送帧
                    - 发送一帧占用总线的时间为T0+t
                    - 极限信道利用率Smax = T0/T0+t
                - 提高信道利用率
                    - Smax = 1/1+(t/T0),设a=t/T0
                    - 参数a应该小。以太网端到端的距离应受限制；以太网帧长度应尽量长
            - 帧的接收流程
                - 监听信道
                - 接收帧
                - 帧长度检测，若小于最短帧长则说明遭遇了碰撞，舍弃
                - 帧的目的MAC地址和接收方MAC地址是否相同或是广播地址，若不相同则丢弃
                - 使用CRC检查帧是否出现误码，若有误码则丢弃
                - 新节点
                - 接收该帧
        - 无线局域网使用的CSMA/CA协议(802.11)
            - 碰撞避免CA功能，不再实现碰撞检测功能
            - 数据链路层使用(停止-等待协议)确认机制
            - 两种不同的媒体接入控制方式
                - 分布式协调功能DCF
                - 点协调功能PCF
            - 帧间间隔IFS
                - 指站点必须在持续检测到信道空闲一段指定时间后才能发送帧
                - 帧间间隔长短取决于该站点要发送的帧类型
                    - 高优先级帧
                    - 低优先级帧
            - 常用的两种帧间间隔
                - 短帧间间隔SIFS(28μs)
                - DCF帧间间隔DIFS(128μs)
            - 退避算法

## MAC地址
- 基本概念
    - 在每个主机发送的帧中必须携带标识发送主机和接收主机的地址。由于这类地址是用于媒体接入控制MAC，因此这类地址被成为MAC地址
    - MAC地址也被成为硬件地址和物理地址
    - MAC地址是对网络上各接口的唯一标识，而不是对网络上各设备的唯一标识。因此交换机和路由器可以拥有多个MAC地址
- IEEE 802局域网的MAC地址格式
    - 组织唯一标识符OUI(由IEEE的注册管理机构分配)
        - 第一个字节b1位表示管理范围
            - 0:全球管理
            - 1:本地管理
        - 第一个字节b0位表示传播范围
            - 0:单播
            - 1:多播
    - 网络接口标识符(由获得OUI的厂商自行随意分配)
- 判断MAC地址是否位多播地址
    - 判断第一字节的第0位
    - 若该位十六进制数不能被2整除，即为多播
- 单播或多播

## 帧结构
- 帧头
    - 多播或目的MAC地址(6B)
    - 本机MAC地址(6B)
    - 类型(2B)
- 数据载荷(必须在46B~1500B之间)
- 帧尾
    - FCS(4B)

## 集线器与交换机
- 集线器
    - 使用双绞线和集线器HUB的星型以太网
        - 逻辑上还是总线网，使用CSMA/CD协议
        - 集线器只工作在物理层
        - 集线器具有少量的容错和网络管理能力
    - 工作在半双工方式
- 交换机
    - 拥有多个接口，每个接口都可以直接与一台主机或另一个交换机相连。一般都工作在全双工方式。
    - 具有并行性，能同时连通多对接口，无碰撞(不使用CSMA/CD协议)
    - 工作在数据链路层(也包括物理层)
    - 收到帧后，在帧交换表中查找帧的目的MAC地址所对应的接口号，然后转发
    - 即插即用，内部的帧交换表是通过自学习算法建立的
    - 帧的两种转发方式
        - 存储转发
        - 直通交换
    - 转发帧的流程
        - 若在交换表中找不到对应MAC地址和端口号，则进行盲目转发
        - 若找到对应MAC帧的端口号，则转发到对应的端口号
    - 自学习流程
        - 转发帧经过交换机
        - 若交换机不存在该转发帧中的源MAC地址，则将源MAC地址和对应进入的端口号添加到交换表
        - 经过一定周期后，交换表中的记录需要删除
    - 生成树协议STP
        - 作用:可以在增加冗余链路来提高网络可靠性的同时又避免网络环路带来的问题
        - 工作原理
            - 无论交换机之间采用怎样的物理连接，交换机都能自动计算并构建一个逻辑上没有环路的网络(拓扑结构一定为树形)
            - 生成的逻辑拓扑确保连通整个网络
            - 当首次连接交换机或网络物理拓扑发生变化时，交换机将进行生成树的重新计算
- 两者区别
    - 集线器工作在物理层；交换机工作在数据链路层(也包括物理层)
    - 集线器会扩大冲突域和广播域；交换机只扩大广播域而不扩大冲突域(隔离广播域VLAN除外)
    - 交换机可以根据MAC地址过滤帧，即隔离碰撞域；而集线器不可以

## 虚拟局域网VLAN
- 基本概念
    - 是一种将局域网内的设备划分成与物理位置无关的逻辑组的技术，这些逻辑组具有某些共同的需求
- 实现机制
    - IEEE 802.1Q帧
        - 是对以太网MAC帧格式的扩展
            - 插入了4字节的VLAN标记
        - 由交换机来处理
            - 收到普通帧时，会插入4字节的VLAN标记转变为802.1Q帧，简称"打标签"
            - 转发802.1Q帧时，可能会删除其4字节的VLAN标记转变为普通帧，简称“去标签”
    - 交换机端口类型
        - Access
            - 只能属于一个VLAN
            - 一般用于用户主机
            - 端口PVID值与端口所属VLAN的ID相同(默认)
            - 接收处理方法
                - 一般只接收普通帧，然后进行打标签
            - 发送处理方法
                - 若帧中VID与端口的PVID相等，则去标签并转发该帧，否则不转发
        - Trunk
            - 一般用于交换机之间或交换机和路由器之间的互连
            - 可以属于多个VLAN
            - 用户可以设置Trunk端口的PVID值，默认PVID为1
            - 接收处理方法
                - 接收未打标签的帧，根据接收帧的端口的PVID给帧打标签
                - 也可以接收未打标签的802.1Q帧
            - 发送处理方法
                - 对VID等于PVID的帧，去标签再转发
                - 对VID不等于PVID的帧，将其直接转发

## 点对点协议PPP
- 对点对点链路传输协议数据报提供了一个标准方法
    - 三部分构成
        - 封装成帧
        - 链路控制协议LCP
            - 用于建立、配置以及测试数据链路的连接
        - 一套网络控制协议NCPs
            - 其中每一个协议支持不同的网络层协议
- 帧格式
    - 首部(5字节)
    - 帧的数据部分(不超过1500字节)
    - 帧的尾部
        - FCS(2字节)用于差错检测
- 透明传输
    - 面向比特的同步链路
        - 采用插入比特0的比特填充法
- 工作状态

## 媒体接入控制
- 基本概念
    - 媒体接入控制MAC
        - 静态划分信道
            - 频分多址
            - 时分多址
                - 同步时分复用
                - 异步时分复用(统计时分复用)
            - 波分复用
            - 码分多址
                - 用户可以在同样的时间使用同样的频带通信
                - 在码分多址中，每一个比特时间再划分为m个短的间隔，成为码片。其值通常为64或128
                - 每个站被指派一个唯一的m bit码片序列，这种通信成为直接序列扩频DSSS
                    - 如果要发送比特1，则发送它自己的m bit码片序列
                    - 如果要发送比特0，则发送它自己的m bit码片序列的二进制反码
                    - 惯例将码片序列中的0写为-1，1写为+1