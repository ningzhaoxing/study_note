# 过程

go三色标记法，实际上是对对象树进行**广度优先搜索**的过程。
- 首先将所有对象放在白色标记队列中；
- 然后从根对象开始搜索，将其子对象暂时存放在灰色标记队列；
- 然后遍历灰色标记队列中的对象，若当前对象没有子对象则将其加入到黑色标记队列；若当前对象有子对象，则将这些子对象加入到灰色标记队列等待搜索。

![[20250302105329.png]]

在开始GC时，会先遍历程序的根节点，然后将其加入到灰色标记表；
然后对灰色标记表的对象遍历其子对象并将其加入到灰色标记表。当某灰色对象的子对象遍历结束后，将其加入到黑色标记表中。
以此类推，直到灰色标记表中没有对象，就将白色标记表中的所有对象清除。

# 无STW问题

如果同时满足以下两个条件，则会出现*对象丢失*现象。
- 条件1：白色对象被黑色对象引用
- 条件2：灰色对象丢失了该白色的可达关系

# 解决无STW问题

## 强弱三色不变式
## 强三色不变式
不允许一个黑色对象引用白色对象。
如果一个黑色对象引用了白色对象，则立即将该白色对象变为灰色对象。

### 弱三色不变式
允许一个黑色对象引用白色对象，但前提是该白色对象的上游必须存在灰色对象。
即该被黑色对象引用的白色对象必须直接或间接地被灰色对象引用。

## 屏障机制

对象被引用时所触发的机制
### 插入屏障

对象被删除时所触发的机制
### 删除屏障
