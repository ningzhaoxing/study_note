# 如何保证Mysql读写缓存一致

项目采用先更新缓存再更新数据库。如果有人点赞了，先将数据记录在redis中，然后通过channel将数据写入到数据库。这样就能保证用户当前获取的数据是最新的。

当然使用channel无法保证消息队列的可靠性，需要使用持久化队列，如Kafka等持久化队列。

优点：
- 适用于读多写少的场景
- 可降低数据库的压力
- 业务需接受短暂的数据不一致问题
- 故障解耦：缓存和数据库解耦

## 问题一

若队列延时写入数据库失败，将保持数据库与缓存的长时间不一致。
**极端场景**：若缓存崩溃后重启，且数据库未更新，系统可能回退到旧数据。

### 重试机制

#### 核心目标

解决**临时性故障**（如网络抖动、数据库短时过载），确保异步操作最终成功执行。

#### 重试策略

##### 队列异步重试

场景：消息队列消费失败(网络原因、数据库短时过载)

实现：
- 消息队列自动重试 + 死信队列

### 补偿机制

#### 核心目标

修复已发生的不一致状态。

#### 定时核对修复

定时一段时间去同步数据

缺点：简单但存在一定时间窗口
#### 事物日志追踪

1. 数据库开启Binlog
2. 使用CDC工具（如Debezium）监听变更
3. 对比缓存与数据库日志

优点：实时性高


## 问题二

你还知道哪些数据库缓存一致问题？
